import{$ as s,o as w,_ as X}from"./index-bd69efc7.js";import{e as Y,b as Z}from"./server-4c5f74d3.js";import{r as z,t as H}from"./server-a9a9b113.js";import{d as J,f as k,r as S,h as Q,c as ee,n as ae,W as m,X as K,Y as M,Z as u,k as n,u as c,G as N,a0 as te,F as le,a8 as oe,a6 as se,g as re}from"./vue-ced722ac.js";import{m as U}from"./antDesign-1cc9e1c8.js";import"./echarts-de64fab6.js";const ne=J({__name:"formModel",props:{show:{type:Boolean,default:!1},status:{type:String,default:"add"},curData:{type:Object,default:()=>{}},sysNormalDisable:{type:Array,default:()=>[]}},emits:["update:show","success"],setup(b,{emit:F}){const{proxy:T}=re(),x=F,r=b,D=k(),g=k(!1),C=k(!1),v=k([]),y=k([]),f=k([]),a=S({roleId:"",roleName:"",roleKey:"",status:"0",menuIds:[],menuCheckStrictly:!0,remark:""}),O=()=>{v.value=[],y.value=[],f.value=[],g.value=!1,C.value=!1,a.roleId="",a.roleName="",a.roleKey="",a.remark="",a.status="0",a.menuIds=[],a.menuCheckStrictly=!0},I=S({roleName:[{required:!0,message:s("inputTips"),trigger:"blur"}],roleKey:[{required:!0,message:s("inputTips"),trigger:"blur"}]});Q(()=>{r.show&&(r.status==="edit"?(a.roleId=r.curData.roleId,a.roleName=r.curData.roleName,a.roleKey=r.curData.roleKey,a.remark=r.curData.remark,a.status=r.curData.status,a.menuCheckStrictly=r.curData.menuCheckStrictly,B(r.curData.roleId)):E())});const h=ee({get(){return r.show},set(t){x("update:show",t)}}),B=async t=>{var o;const e=await z(t);if((e==null?void 0:e.code)===200){const d=((o=e==null?void 0:e.data)==null?void 0:o.menus)??[],i=w(d||[]).map(p=>(p!=null&&p.label&&(p.label=s(p.label)),p));v.value=T.handleTree(i,"id"),ae(()=>{f.value=e.data.checkedKeys||[]})}},E=async()=>{const t=await H();if((t==null?void 0:t.code)===200){const{data:e=[]}=t,_=w(e||[]).map(i=>(i!=null&&i.label&&(i.label=s(i.label)),i));v.value=T.handleTree(_,"id")}},R=t=>{const e=v.value;t.target.checked?y.value=e.map(o=>o.id):y.value=[]},A=t=>{const e=v.value;if(t.target.checked){const o=w(e);f.value=o.map(d=>d.id)}else f.value=[]},L=t=>{t.value=t},V=()=>{O()},q=async()=>{D.value.validate().then(async()=>{var e;const t={roleName:a.roleName,roleKey:a.roleKey,remark:a.remark,status:a.status,menuIds:f.value,menuCheckStrictly:a.menuCheckStrictly?1:0};if(r.status==="edit"){t.roleId=(e=r==null?void 0:r.curData)==null?void 0:e.roleId;const o=await Y(t);(o==null?void 0:o.code)===200&&(h.value=!1,U.success(s("opeateSuccess")),x("success"))}else{const o=await Z(t);(o==null?void 0:o.code)===200&&(h.value=!1,U.success(s("opeateSuccess")),x("success"))}}).catch(t=>{})};return(t,e)=>{const o=m("a-input"),d=m("a-form-item"),_=m("a-checkbox"),i=m("a-tree"),p=m("a-radio"),W=m("a-radio-group"),$=m("a-textarea"),j=m("a-form"),G=m("watermark"),P=m("a-modal");return K(),M(P,{destroyOnClose:"",open:h.value,"onUpdate:open":e[8]||(e[8]=l=>h.value=l),title:b.status==="add"?c(s)("opts.add"):c(s)("opts.edit"),width:"500px",cancelText:c(s)("opts.cancel"),okText:c(s)("opts.sure"),afterClose:V,onOk:q},{default:u(()=>[n(G,null,{default:u(()=>[n(j,{class:"w100",ref_key:"formRef",ref:D,model:a,labelWrap:"",labelCol:{style:{width:"110px"}}},{default:u(()=>[n(d,{label:c(s)("role.columns.roleName"),name:"roleName",rules:I.roleName},{default:u(()=>[n(o,{allowClear:"",placeholder:c(s)("inputTips"),value:a.roleName,"onUpdate:value":e[0]||(e[0]=l=>a.roleName=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label","rules"]),n(d,{label:c(s)("role.columns.roleKey"),name:"roleKey",rules:I.roleKey},{default:u(()=>[n(o,{allowClear:"",placeholder:c(s)("inputTips"),value:a.roleKey,"onUpdate:value":e[1]||(e[1]=l=>a.roleKey=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label","rules"]),n(d,{label:c(s)("role.columns.menuPermission")},{default:u(()=>[n(_,{checked:g.value,"onUpdate:checked":e[2]||(e[2]=l=>g.value=l),onChange:R},{default:u(()=>[N("展开/折叠")]),_:1},8,["checked"]),n(_,{checked:C.value,"onUpdate:checked":e[3]||(e[3]=l=>C.value=l),onChange:A},{default:u(()=>[N("全选/全不选")]),_:1},8,["checked"]),n(i,{class:"tree-border",expandedKeys:y.value,"onUpdate:expandedKeys":e[4]||(e[4]=l=>y.value=l),checkedKeys:f.value,"onUpdate:checkedKeys":e[5]||(e[5]=l=>f.value=l),"tree-data":v.value,checkable:"",onCheck:L,"check-strictly":!a.menuCheckStrictly,fieldNames:{title:"label",key:"id",children:"children"}},null,8,["expandedKeys","checkedKeys","tree-data","check-strictly"])]),_:1},8,["label"]),n(d,{label:c(s)("role.columns.state")},{default:u(()=>[n(W,{value:a.status,"onUpdate:value":e[6]||(e[6]=l=>a.status=l),name:"postState"},{default:u(()=>[(K(!0),te(le,null,oe(b.sysNormalDisable,l=>(K(),M(p,{key:l.value,value:l.value},{default:u(()=>[N(se(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),n(d,{label:c(s)("role.columns.remark")},{default:u(()=>[n($,{allowClear:"",placeholder:c(s)("inputTips"),value:a.remark,"onUpdate:value":e[7]||(e[7]=l=>a.remark=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["open","title","cancelText","okText"])}}});const fe=X(ne,[["__scopeId","data-v-c35d5cb4"]]);export{fe as default};
