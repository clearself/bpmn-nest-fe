import{$ as o,E as K,h as X,d as Y}from"./index-BI1T92go.js";import{e as Z,b as z}from"./server-DIAOfSFm.js";import{r as H,t as J}from"./server-Cq249MR0.js";import{a as S}from"./antDesign-wbdAq9hh.js";import{d as Q,f as k,r as U,h as ee,c as ae,n as te,W as m,X as w,Y as M,Z as u,k as n,u as c,G as N,a0 as le,F as se,a7 as oe,a5 as re,g as ne}from"./vue-CuEiQHfR.js";import"./echarts-DSOc99Qa.js";const ue=Q({__name:"formModel",props:{show:{type:Boolean,default:!1},status:{type:String,default:"add"},curData:{type:Object,default:()=>{}},sysNormalDisable:{type:Array,default:()=>[]}},emits:["update:show","success"],setup(b,{emit:F}){const{proxy:T}=ne(),x=F,r=b,D=k(),C=k(!1),g=k(!1),v=k([]),y=k([]),f=k([]),a=U({roleId:"",roleName:"",roleKey:"",status:"0",menuIds:[],menuCheckStrictly:!0,remark:""}),E=()=>{v.value=[],y.value=[],f.value=[],C.value=!1,g.value=!1,a.roleId="",a.roleName="",a.roleKey="",a.remark="",a.status="0",a.menuIds=[],a.menuCheckStrictly=!0},I=U({roleName:[{required:!0,message:o("inputTips"),trigger:"blur"}],roleKey:[{required:!0,message:o("inputTips"),trigger:"blur"}]});ee(()=>{r.show&&(r.status==="edit"?(a.roleId=r.curData.roleId,a.roleName=r.curData.roleName,a.roleKey=r.curData.roleKey,a.remark=r.curData.remark,a.status=r.curData.status,a.menuCheckStrictly=r.curData.menuCheckStrictly,O(r.curData.roleId)):B())});const _=ae({get(){return r.show},set(t){x("update:show",t)}}),O=async t=>{var s;const e=await H(t);if((e==null?void 0:e.code)===200){const d=((s=e==null?void 0:e.data)==null?void 0:s.menus)??[],i=K(d||[]).map(p=>(p!=null&&p.label&&(p.label=o(p.label)),p));v.value=T.handleTree(i,"id"),te(()=>{f.value=e.data.checkedKeys||[]})}},B=async()=>{const t=await J();if((t==null?void 0:t.code)===200){const{data:e=[]}=t,h=K(e||[]).map(i=>(i!=null&&i.label&&(i.label=o(i.label)),i));v.value=T.handleTree(h,"id")}},R=t=>{const e=v.value;t.target.checked?y.value=e.map(s=>s.id):y.value=[]},A=t=>{const e=v.value;if(t.target.checked){const s=K(e);f.value=s.map(d=>d.id)}else f.value=[]},L=t=>{t.value=t},V=()=>{E()},$=async()=>{D.value.validate().then(async()=>{var e;const t={roleName:a.roleName,roleKey:a.roleKey,remark:a.remark,status:a.status,menuIds:f.value,menuCheckStrictly:a.menuCheckStrictly?1:0};if(r.status==="edit"){t.roleId=(e=r==null?void 0:r.curData)==null?void 0:e.roleId;const s=await Z(t);(s==null?void 0:s.code)===200&&(_.value=!1,S.success(o("opeateSuccess")),x("success"))}else{const s=await z(t);(s==null?void 0:s.code)===200&&(_.value=!1,S.success(o("opeateSuccess")),x("success"))}}).catch(t=>{})};return(t,e)=>{const s=m("a-input"),d=m("a-form-item"),h=m("a-checkbox"),i=m("a-tree"),p=m("a-radio"),q=m("a-radio-group"),W=m("a-textarea"),j=m("a-form"),G=X,P=m("a-modal");return w(),M(P,{destroyOnClose:"",open:_.value,"onUpdate:open":e[8]||(e[8]=l=>_.value=l),title:b.status==="add"?c(o)("opts.add"):c(o)("opts.edit"),width:"500px",cancelText:c(o)("opts.cancel"),okText:c(o)("opts.sure"),afterClose:V,onOk:$},{default:u(()=>[n(G,null,{default:u(()=>[n(j,{class:"w100",ref_key:"formRef",ref:D,model:a,labelWrap:"",labelCol:{style:{width:"110px"}}},{default:u(()=>[n(d,{label:c(o)("role.columns.roleName"),name:"roleName",rules:I.roleName},{default:u(()=>[n(s,{allowClear:"",placeholder:c(o)("inputTips"),value:a.roleName,"onUpdate:value":e[0]||(e[0]=l=>a.roleName=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label","rules"]),n(d,{label:c(o)("role.columns.roleKey"),name:"roleKey",rules:I.roleKey},{default:u(()=>[n(s,{allowClear:"",placeholder:c(o)("inputTips"),value:a.roleKey,"onUpdate:value":e[1]||(e[1]=l=>a.roleKey=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label","rules"]),n(d,{label:c(o)("role.columns.menuPermission")},{default:u(()=>[n(h,{checked:C.value,"onUpdate:checked":e[2]||(e[2]=l=>C.value=l),onChange:R},{default:u(()=>e[9]||(e[9]=[N("展开/折叠")])),_:1},8,["checked"]),n(h,{checked:g.value,"onUpdate:checked":e[3]||(e[3]=l=>g.value=l),onChange:A},{default:u(()=>e[10]||(e[10]=[N("全选/全不选")])),_:1},8,["checked"]),n(i,{class:"tree-border",expandedKeys:y.value,"onUpdate:expandedKeys":e[4]||(e[4]=l=>y.value=l),checkedKeys:f.value,"onUpdate:checkedKeys":e[5]||(e[5]=l=>f.value=l),"tree-data":v.value,checkable:"",onCheck:L,"check-strictly":!a.menuCheckStrictly,fieldNames:{title:"label",key:"id",children:"children"}},null,8,["expandedKeys","checkedKeys","tree-data","check-strictly"])]),_:1},8,["label"]),n(d,{label:c(o)("role.columns.state")},{default:u(()=>[n(q,{value:a.status,"onUpdate:value":e[6]||(e[6]=l=>a.status=l),name:"postState"},{default:u(()=>[(w(!0),le(se,null,oe(b.sysNormalDisable,l=>(w(),M(p,{key:l.value,value:l.value},{default:u(()=>[N(re(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),n(d,{label:c(o)("role.columns.remark")},{default:u(()=>[n(W,{allowClear:"",placeholder:c(o)("inputTips"),value:a.remark,"onUpdate:value":e[7]||(e[7]=l=>a.remark=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})]),_:1},8,["open","title","cancelText","okText"])}}}),ve=Y(ue,[["__scopeId","data-v-c35d5cb4"]]);export{ve as default};
