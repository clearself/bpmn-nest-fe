import{$ as o,y as L,C as W,f as j,b as G}from"./index-BeIH9SCz.js";import{d as P,f as p,r as w,h as X,c as Y,n as Z,W as i,X as z,Y as H,Z as u,k as s,u as c,m as J,G as x,A as Q}from"./vue-CuEiQHfR.js";import{d as ee,a as ae}from"./server-RL5PAvx2.js";import{a as te}from"./antDesign-CdRSJcA9.js";import"./echarts-DSOc99Qa.js";const le=P({__name:"formDataModel",props:{show:{type:Boolean,default:!1},curData:{type:Object,default:()=>{}}},emits:["update:show","success"],setup(K,{emit:N}){const{filterOption:T}=L(),b=N,r=K,_=p(),h=p(!1),y=p(!1),f=p([]),v=p([]),n=p([]),g=p([{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}]),a=w({roleId:"",roleName:"",roleKey:"",dataScope:"1",deptIds:[],deptCheckStrictly:!0}),D=()=>{f.value=[],v.value=[],n.value=[],h.value=!1,y.value=!1,a.roleId="",a.roleName="",a.roleKey="",a.dataScope="1",a.deptIds=[],a.deptCheckStrictly=!0},C=w({roleName:[{required:!0,message:o("inputTips"),trigger:"blur"}],roleKey:[{required:!0,message:o("inputTips"),trigger:"blur"}]});X(()=>{r.show&&(a.roleId=r.curData.roleId,a.roleName=r.curData.roleName,a.roleKey=r.curData.roleKey,a.dataScope=r.curData.dataScope,a.deptCheckStrictly=r.curData.deptCheckStrictly,O(r.curData.roleId))});const k=Y({get(){return r.show},set(t){b("update:show",t)}}),I=t=>{t!=="2"&&(n.value=[])},O=async t=>{const e=await ee(t);(e==null?void 0:e.code)===200&&(f.value=e.data.depts,Z(()=>{n.value=e.data.checkedKeys||[]}))},U=t=>{const e=f.value;t.target.checked?v.value=e.map(d=>d.id):v.value=[]},M=t=>{const e=f.value;if(t.target.checked){const d=W(e);n.value=d.map(m=>m.id)}else n.value=[]},R=t=>{t.value=t},A=()=>{D()},B=async()=>{_.value.validate().then(async()=>{var d;const t={roleName:a.roleName,roleKey:a.roleKey,dataScope:a.dataScope,deptIds:n.value,deptCheckStrictly:n.value.deptCheckStrictly};t.roleId=(d=r==null?void 0:r.curData)==null?void 0:d.roleId;const e=await ae(t);(e==null?void 0:e.code)===200&&(k.value=!1,te.success(o("opeateSuccess")),b("success"))}).catch(t=>{})};return(t,e)=>{const d=i("a-input"),m=i("a-form-item"),E=i("a-select"),S=i("a-checkbox"),F=i("a-tree"),V=i("a-form"),$=j,q=i("a-modal");return z(),H(q,{destroyOnClose:"",open:k.value,"onUpdate:open":e[7]||(e[7]=l=>k.value=l),title:"分配数据权限",width:"500px",cancelText:c(o)("opts.cancel"),okText:c(o)("opts.sure"),afterClose:A,onOk:B},{default:u(()=>[s($,null,{default:u(()=>[s(V,{class:"w100",ref_key:"formRef",ref:_,model:a,labelWrap:"",labelCol:{style:{width:"110px"}}},{default:u(()=>[s(m,{label:c(o)("role.columns.roleName"),name:"roleName",rules:C.roleName},{default:u(()=>[s(d,{disabled:"",allowClear:"",placeholder:c(o)("inputTips"),value:a.roleName,"onUpdate:value":e[0]||(e[0]=l=>a.roleName=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label","rules"]),s(m,{label:c(o)("role.columns.roleKey"),name:"roleKey",rules:C.roleKey},{default:u(()=>[s(d,{disabled:"",allowClear:"",placeholder:c(o)("inputTips"),value:a.roleKey,"onUpdate:value":e[1]||(e[1]=l=>a.roleKey=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label","rules"]),s(m,{label:c(o)("role.columns.dataScope")},{default:u(()=>[s(E,{"show-search":"","filter-option":c(T),options:g.value,allowClear:"",placeholder:c(o)("selectTips"),style:{width:"100%"},value:a.dataScope,"onUpdate:value":e[2]||(e[2]=l=>a.dataScope=l),onChange:I},null,8,["filter-option","options","placeholder","value"])]),_:1},8,["label"]),J(s(m,{label:c(o)("role.columns.menuPermission")},{default:u(()=>[s(S,{checked:h.value,"onUpdate:checked":e[3]||(e[3]=l=>h.value=l),onChange:U},{default:u(()=>e[8]||(e[8]=[x("展开/折叠")])),_:1},8,["checked"]),s(S,{checked:y.value,"onUpdate:checked":e[4]||(e[4]=l=>y.value=l),onChange:M},{default:u(()=>e[9]||(e[9]=[x("全选/全不选")])),_:1},8,["checked"]),s(F,{class:"tree-border",expandedKeys:v.value,"onUpdate:expandedKeys":e[5]||(e[5]=l=>v.value=l),checkedKeys:n.value,"onUpdate:checkedKeys":e[6]||(e[6]=l=>n.value=l),"tree-data":f.value,checkable:"",onCheck:R,"check-strictly":!a.deptCheckStrictly,fieldNames:{title:"label",key:"id",children:"children"}},null,8,["expandedKeys","checkedKeys","tree-data","check-strictly"])]),_:1},8,["label"]),[[Q,a.dataScope==2]])]),_:1},8,["model"])]),_:1})]),_:1},8,["open","cancelText","okText"])}}}),de=G(le,[["__scopeId","data-v-a2a95039"]]);export{de as default};
