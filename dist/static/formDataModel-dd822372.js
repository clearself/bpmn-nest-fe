import{d as W,f as i,r as w,h as $,c as j,n as G,W as p,X as P,Y as X,Z as u,k as o,u as c,m as Y,G as x,A as Z}from"./vue-87dd1d62.js";import{$ as s,n as z,o as H,_ as J}from"./index-c069a2e6.js";import{d as Q,a as ee}from"./server-03ea8e8f.js";import{m as ae}from"./antDesign-ac8834bc.js";import"./echarts-de64fab6.js";const te=W({__name:"formDataModel",props:{show:{type:Boolean,default:!1},curData:{type:Object,default:()=>{}}},emits:["update:show","success"],setup(K,{emit:N}){const{filterOption:g}=z(),_=N,r=K,b=i(),h=i(!1),y=i(!1),f=i([]),v=i([]),n=i([]),T=i([{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}]),a=w({roleId:"",roleName:"",roleKey:"",dataScope:"1",deptIds:[],deptCheckStrictly:!0}),D=()=>{f.value=[],v.value=[],n.value=[],h.value=!1,y.value=!1,a.roleId="",a.roleName="",a.roleKey="",a.dataScope="1",a.deptIds=[],a.deptCheckStrictly=!0},S=w({roleName:[{required:!0,message:s("inputTips"),trigger:"blur"}],roleKey:[{required:!0,message:s("inputTips"),trigger:"blur"}]});$(()=>{r.show&&(a.roleId=r.curData.roleId,a.roleName=r.curData.roleName,a.roleKey=r.curData.roleKey,a.dataScope=r.curData.dataScope,a.deptCheckStrictly=r.curData.deptCheckStrictly,O(r.curData.roleId))});const k=j({get(){return r.show},set(t){_("update:show",t)}}),I=t=>{t!=="2"&&(n.value=[])},O=async t=>{const e=await Q(t);(e==null?void 0:e.code)===200&&(f.value=e.data.depts,G(()=>{n.value=e.data.checkedKeys||[]}))},U=t=>{const e=f.value;t.target.checked?v.value=e.map(d=>d.id):v.value=[]},M=t=>{const e=f.value;if(t.target.checked){const d=H(e);n.value=d.map(m=>m.id)}else n.value=[]},R=t=>{t.value=t},A=()=>{D()},B=async()=>{b.value.validate().then(async()=>{var d;const t={roleName:a.roleName,roleKey:a.roleKey,dataScope:a.dataScope,deptIds:n.value,deptCheckStrictly:n.value.deptCheckStrictly};t.roleId=(d=r==null?void 0:r.curData)==null?void 0:d.roleId;const e=await ee(t);(e==null?void 0:e.code)===200&&(k.value=!1,ae.success(s("opeateSuccess")),_("success"))}).catch(t=>{})};return(t,e)=>{const d=p("a-input"),m=p("a-form-item"),E=p("a-select"),C=p("a-checkbox"),F=p("a-tree"),V=p("a-form"),q=p("watermark"),L=p("a-modal");return P(),X(L,{destroyOnClose:"",open:k.value,"onUpdate:open":e[7]||(e[7]=l=>k.value=l),title:"分配数据权限",width:"500px",cancelText:c(s)("opts.cancel"),okText:c(s)("opts.sure"),afterClose:A,onOk:B},{default:u(()=>[o(q,null,{default:u(()=>[o(V,{class:"w100",ref_key:"formRef",ref:b,model:a,labelWrap:"",labelCol:{style:{width:"110px"}}},{default:u(()=>[o(m,{label:c(s)("role.columns.roleName"),name:"roleName",rules:S.roleName},{default:u(()=>[o(d,{disabled:"",allowClear:"",placeholder:c(s)("inputTips"),value:a.roleName,"onUpdate:value":e[0]||(e[0]=l=>a.roleName=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label","rules"]),o(m,{label:c(s)("role.columns.roleKey"),name:"roleKey",rules:S.roleKey},{default:u(()=>[o(d,{disabled:"",allowClear:"",placeholder:c(s)("inputTips"),value:a.roleKey,"onUpdate:value":e[1]||(e[1]=l=>a.roleKey=l),valueModifiers:{trim:!0}},null,8,["placeholder","value"])]),_:1},8,["label","rules"]),o(m,{label:c(s)("role.columns.dataScope")},{default:u(()=>[o(E,{"show-search":"","filter-option":c(g),options:T.value,allowClear:"",placeholder:c(s)("selectTips"),style:{width:"100%"},value:a.dataScope,"onUpdate:value":e[2]||(e[2]=l=>a.dataScope=l),onChange:I},null,8,["filter-option","options","placeholder","value"])]),_:1},8,["label"]),Y(o(m,{label:c(s)("role.columns.menuPermission")},{default:u(()=>[o(C,{checked:h.value,"onUpdate:checked":e[3]||(e[3]=l=>h.value=l),onChange:U},{default:u(()=>[x("展开/折叠")]),_:1},8,["checked"]),o(C,{checked:y.value,"onUpdate:checked":e[4]||(e[4]=l=>y.value=l),onChange:M},{default:u(()=>[x("全选/全不选")]),_:1},8,["checked"]),o(F,{class:"tree-border",expandedKeys:v.value,"onUpdate:expandedKeys":e[5]||(e[5]=l=>v.value=l),checkedKeys:n.value,"onUpdate:checkedKeys":e[6]||(e[6]=l=>n.value=l),"tree-data":f.value,checkable:"",onCheck:R,"check-strictly":!a.deptCheckStrictly,fieldNames:{title:"label",key:"id",children:"children"}},null,8,["expandedKeys","checkedKeys","tree-data","check-strictly"])]),_:1},8,["label"]),[[Z,a.dataScope==2]])]),_:1},8,["model"])]),_:1})]),_:1},8,["open","cancelText","okText"])}}});const ne=J(te,[["__scopeId","data-v-a2a95039"]]);export{ne as default};
